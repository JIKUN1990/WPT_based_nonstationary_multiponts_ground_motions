%% 输入加速度时程数据
function [SAmax,SVmax,SDmax,location] = response_spectral_JK_fast(acc,T,periods,kesi)
%单位换算回去

% load elcen.dat;
% t=elcen(:,1);
% xg=elcen(:,2)/100;  % 地震动加速度，这里需要换算单位，由cm/s2变为标准单位

t=T;
xg=acc/100;
%%计算伪加速度谱
% kesi=0.05;       % 结构阻尼比
TT=periods;
% TT=[0.0100000000000000,0.0200000000000000,0.0220000000000000,0.0250000000000000,0.0290000000000000,0.0300000000000000,0.0320000000000000,0.0350000000000000,0.0360000000000000,0.0400000000000000,0.0420000000000000,0.0440000000000000,0.0450000000000000,0.0460000000000000,0.0480000000000000,0.0500000000000000,0.0550000000000000,0.0600000000000000,0.0650000000000000,0.0670000000000000,0.0700000000000000,0.0750000000000000,0.0800000000000000,0.0850000000000000,0.0900000000000000,0.0950000000000000,0.100000000000000,0.110000000000000,0.120000000000000,0.130000000000000,0.133000000000000,0.140000000000000,0.150000000000000,0.160000000000000,0.170000000000000,0.180000000000000,0.190000000000000,0.200000000000000,0.220000000000000,0.240000000000000,0.250000000000000,0.260000000000000,0.280000000000000,0.290000000000000,0.300000000000000,0.320000000000000,0.340000000000000,0.350000000000000,0.360000000000000,0.380000000000000,0.400000000000000,0.420000000000000,0.440000000000000,0.450000000000000,0.460000000000000,0.480000000000000,0.500000000000000,0.550000000000000,0.600000000000000,0.650000000000000,0.667000000000000,0.700000000000000,0.750000000000000,0.800000000000000,0.850000000000000,0.900000000000000,0.950000000000000,1,1.10000000000000,1.20000000000000,1.30000000000000,1.40000000000000,1.50000000000000,1.60000000000000,1.70000000000000,1.80000000000000,1.90000000000000,2,2.20000000000000,2.40000000000000,2.50000000000000,2.60000000000000,2.80000000000000,3,3.20000000000000,3.40000000000000,3.50000000000000,3.60000000000000,3.80000000000000,4,4.20000000000000,4.40000000000000,4.60000000000000,4.80000000000000,5,5.50000000000000,6,6.50000000000000,7,7.50000000000000,8,8.50000000000000,9,9.50000000000000,10];
for i=1:length(TT) %不同自振周期 
T=TT(i);
    omiga=2*pi/T;    % 不同圆频率
 
A=[0 1;-omiga^2 -2*kesi*omiga];
B=[0;-1];
C=eye(2);
D=zeros(2,1);
y=lsim(A,B,C,D,xg,t);% 分别计算出位移(第一列)和速度响应（第二列）

SA=y(:,1)*omiga^2; %  
SD(i)=max(y(:,1));%求不同自振周期下的谱位移（谱位移）
SV(i)=max(y(:,2)); % 求不同自振周期下的谱速度（谱速度）
SAmax(i)=max(abs(SA)).*100; %求不同自振周期下的伪加速度;
location(i)=find(abs(SA)==max(abs(SA)));
% Tpeak(i,1)=location(1);
% Tpeak(i,2)=TT(location(1));

SVmax(i)=SAmax(i)/(omiga); %伪速度 
SDmax(i)=SAmax(i)/(omiga)^2; %伪位移
% SA1=-2*kesi*omiga*y(:,2)-y(:,1)*omiga^2;%由平衡方程推导出结构绝对加速度值
% SA1max(i)=max(abs(SA1)); %求不同周期下的绝对加速度最大值（谱加速度）
% Ratio(i)=SA1max(i)/SAmax(i);
end
end
 
% %% 绘制曲线(对数)
% t=0.01:0.05:10;
% semilogx(t,SAmax,'ok')
% hold on;
% semilogx(t,SA1max,'k')
% title('加速度与伪加速度谱')
% xlabel('Tn（s）')
% ylabel('Acc')
% legend('伪加速度','绝对加速度')
% %% 绘制曲线（直角）
% plot(t,SAmax,'.k')
% hold on;
% plot(t,SA1max,'k')
% title('加速度与伪加速度谱')
% xlabel('Tn（s）')
% ylabel('Acc')
% legend('伪加速度','绝对加速度')
% %% 绘制谱比曲线（伪谱加速度/谱绝对加速度）
% semilogx(t,Ratio,'-.k')
% title('绝对加速度/伪加速度谱')
% xlabel('Tn（s）')
% ylabel('ratio')